import{u as _,d as p,r as N,o as v,e as O,a as m,w as c,f as b,g,c as q,h as M}from"./index-B4C7dQAl.js";import{V as h,a as A,b as y,c as L,i as u,d as B,A as E}from"./VTextField-DCEyhH4L.js";const w={_origin:"https://api.emailjs.com"},R=(s,t="https://api.emailjs.com")=>{w._userID=s,w._origin=t},D=(s,t,r)=>{if(!s)throw"The user ID is required. Visit https://dashboard.emailjs.com/admin/integration";if(!t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!r)throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates";return!0};class H{constructor(t){this.status=t.status,this.text=t.responseText}}const I=(s,t,r={})=>new Promise((i,l)=>{const a=new XMLHttpRequest;a.addEventListener("load",({target:o})=>{const d=new H(o);d.status===200||d.text==="OK"?i(d):l(d)}),a.addEventListener("error",({target:o})=>{l(new H(o))}),a.open("POST",w._origin+s,!0),Object.keys(r).forEach(o=>{a.setRequestHeader(o,r[o])}),a.send(t)}),U=(s,t,r,i)=>{const l=i||w._userID;return D(l,s,t),I("/api/v1.0/email/send",JSON.stringify({lib_version:"3.2.0",user_id:l,service_id:s,template_id:t,template_params:r}),{"Content-type":"application/json"})},$=s=>{let t;if(typeof s=="string"?t=document.querySelector(s):t=s,!t||t.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of form";return t},z=(s,t,r,i)=>{const l=i||w._userID,a=$(r);D(l,s,t);const o=new FormData(a);return o.append("lib_version","3.2.0"),o.append("service_id",s),o.append("template_id",t),o.append("user_id",l),I("/api/v1.0/email/send-form",o)},S={init:R,send:U,sendForm:z},J={class:"d-flex align-center justify-center",style:{"min-height":"100vh"}},K={key:0},W={key:1},X={key:0},Y={key:1},Z="service_cojqzzb",G="template_bql1hr5",Q="YVFyP3Zy91mr0Jc5W",ee=.5*60*1e3,re={__name:"index",setup(s){const t=_(),r=p(!1),i=p(""),l=p(""),a=p(""),o=p(""),d=p(""),C=p(!0),k=p(!0);S.init(Q);const T=p(null),x=p(!1);async function V(){function f(){return Math.floor(1e5+Math.random()*9e5).toString()}if(T.value=new Date().getTime(),!i.value){u.warn("Please enter a valid email address!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0});return}const e=await B.post(E.CHECK_EMAIL_EXISTS,{email:i.value});try{if(e.data.exists){d.value=f();const P={email:i.value,otp_code:d.value};S.send(Z,G,P).then(n=>{u.success("Send OTP successful!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),C.value=!1}).catch(n=>{u.warn("Failed to send OTP. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})})}else u.error("Email does not exist.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}catch(P){u.error(`Error checking email ${P}`,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}}function F(){if(!o.value){u.warn("Please enter a valid OTP.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0});return}if(new Date().getTime()-T.value>ee){x.value=!0,d.value="",u.error("The OTP code has expired.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0});return}o.value===d.value?(k.value=!1,d.value=""):u.warn("OTP does not match.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}async function j(){if(l.value.trim()==""||a.value.trim()==""){u.warn("Please enter a valid Password.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0});return}if(l.value!==a.value){u.warn("Passwords do not match. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0});return}try{console.log("email.value",i.value),console.log("confirmPassword.value",a.value),(await B.post(E.UPDATE_PASSWORD,{Email:i.value,NewPassword:a.value})).data.success?(u.success("Password updated successfully!",{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),setTimeout(()=>{t.push("/login")},2e3)):u.error("Failed to update password. Please check your OTP.",{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}catch{u.error("An error occurred while updating the password. Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}}return(f,e)=>{const P=N("router-link");return v(),O("div",J,[m(L,{class:"mx-auto pa-12 pb-8",elevation:"8","max-width":"448","min-width":"448",rounded:"lg"},{default:c(()=>[C.value?(v(),O("div",K,[e[13]||(e[13]=b("div",{class:"text-subtitle-1 text-medium-emphasis"},"Email",-1)),m(h,{density:"compact",placeholder:"Email Address","prepend-inner-icon":"mdi-email-outline",variant:"outlined",modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=n=>i.value=n)},null,8,["modelValue"]),m(P,{class:"text-caption text-decoration-none text-blue",to:"/login"},{default:c(()=>[m(A,null,{default:c(()=>e[10]||(e[10]=[g("mdi-arrow-left")])),_:1}),e[11]||(e[11]=g(" Back to Login "))]),_:1}),m(y,{class:"mb-8 mt-8",color:"blue",size:"large",variant:"tonal",block:"",onClick:e[1]||(e[1]=n=>V())},{default:c(()=>e[12]||(e[12]=[g(" Send OTP ")])),_:1})])):(v(),O("div",W,[k.value?(v(),O("div",X,[e[16]||(e[16]=b("div",{class:"text-subtitle-1 text-medium-emphasis"},"OTP",-1)),m(h,{density:"compact",placeholder:"Enter OTP","prepend-inner-icon":"mdi-key",variant:"outlined",modelValue:o.value,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value=n)},null,8,["modelValue"]),m(y,{class:"mb-4 mt-4",color:"blue",size:"large",variant:"tonal",block:"",onClick:e[3]||(e[3]=n=>F())},{default:c(()=>e[14]||(e[14]=[g(" Verify OTP ")])),_:1}),x.value==!0?(v(),q(y,{key:0,color:"blue",size:"large",variant:"tonal",block:"",onClick:e[4]||(e[4]=n=>V())},{default:c(()=>e[15]||(e[15]=[g(" Resend OTP ")])),_:1})):M("",!0)])):(v(),O("div",Y,[e[18]||(e[18]=b("div",{class:"text-subtitle-1 text-medium-emphasis d-flex align-center justify-space-between"}," Password ",-1)),m(h,{"append-inner-icon":r.value?"mdi-eye-off":"mdi-eye",type:r.value?"text":"password",density:"compact",placeholder:"Enter your new password","prepend-inner-icon":"mdi-lock-outline",variant:"outlined",modelValue:l.value,"onUpdate:modelValue":e[5]||(e[5]=n=>l.value=n),"onClick:appendInner":e[6]||(e[6]=n=>r.value=!r.value)},null,8,["append-inner-icon","type","modelValue"]),e[19]||(e[19]=b("div",{class:"text-subtitle-1 text-medium-emphasis d-flex align-center justify-space-between"}," Confirm Password ",-1)),m(h,{"append-inner-icon":r.value?"mdi-eye-off":"mdi-eye",type:r.value?"text":"password",density:"compact",placeholder:"Enter your new password","prepend-inner-icon":"mdi-lock-outline",variant:"outlined",modelValue:a.value,"onUpdate:modelValue":e[7]||(e[7]=n=>a.value=n),"onClick:appendInner":e[8]||(e[8]=n=>r.value=!r.value)},null,8,["append-inner-icon","type","modelValue"]),m(y,{class:"mb-8 mt-8",color:"blue",size:"large",variant:"tonal",block:"",onClick:e[9]||(e[9]=n=>j())},{default:c(()=>e[17]||(e[17]=[g(" Update Password ")])),_:1})]))]))]),_:1})])}}};export{re as default};
